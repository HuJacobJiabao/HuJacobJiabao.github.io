---
title: Blender-Python API Meshing (1)
date: 2022-04-16 19:29:34
tags: [Blender, Python, Modelling]
categories: Blender
katex: true
---
# Blender-Python API Meshing
## Introduction
> *Blender is a free and open-source 3D computer graphics software toolset used for creating animated films, visual effects, art, 3D-printed models, motion graphics, interactive 3D applications, virtual reality, and, formerly, video games.*
  
It is a tutorial to teach you how to create mesh by Blender-Python.

First of all, to be able to use the Blender-Python API, you need to import the **bpy** library.

```python
import bpy
```

When you open your new blender python, you can find a cube in the origin. And there is only one area for operating. What we are going to do is to create two new areas. 
<figure>
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/1.jpg'>
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/2.jpg'>
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/3.jpg'>
</figure>
And set the different regions like the figure shown below. It's my personal preferrence, you can set the region as your like. 
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/5.jpg'>

### Python Console
Let's firstly use the python console.
```console
>>> bpy.data.objects
<bpy_collection[3], BlendDataObjects>

>>> bpy.data.objects.keys()
['Camera', 'Cube', 'Light']
```
And we can assign the object `'Cube'` to a variable `cube`. And move the cube to another position.
```console
>>> cube = bpy.data.objects['Cube']
>>> cube.location
Vector((0.0, 0.0, 0.0))

>>> cube.location = (1, 1, 1)
```
Then the centroid of the cube will move to `(1, 1, 1)`.
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/6.jpg'>
### Text Editor
The operations above can be done by using the script in the text editor.
```python
import bpy

cube = bpy.data.objects['Cube']
cube.location = (1, 1, 1)
```

## Mesh

In order to create mesh for a desirable objects. We need to define the vertices and faces.

### Mesh a plate
Let's create a plate

```python
import bpy

# Select and delete all the objects
bpy.ops.object.select_all(action = 'SELECT')
bpy.ops.object.delete()

vertices = [(-1, -1, 0), (1, -0, 0), (1, 1, 0), (-1, 1, 0)] # The coordinates of different vertices
faces = [(0, 1, 2, 3)] # Only one face, so the shape is a plate.

name = 'New Plate'
mesh = bpy.data.meshes.new(name)

obj = bpy.data.objects.new(name, mesh)

bpy.context.scene.collection.objects.link(obj)

mesh.from_pydata(vertices,[],faces)
mesh.update(calc_edges=True)
```
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/7.jpg'>

### Mesh a 3D Supershape
#### 3D Supershape
A 3D supershape can be parameterized by the [Superformula](https://en.wikipedia.org/wiki/Superformula#3D_plots).
> *The superformula is a generalization of the superellipse and was proposed by Johan Gielis around 2000.[1] Gielis suggested that the formula can be used to describe many complex shapes and curves that are found in nature. Gielis has filed a patent application related to the synthesis of patterns generated by the superformula.*

In polar coordinates, with $r$ the radius and $\varphi$ the angle, the superformula is,
$$r(\varphi) = (|\frac{\cos(\frac{m\varphi}4)}a|^{n_2} + |\frac{\sin(\frac{m\varphi}4)}b|^{n_3})^{n_1}$$

By changing $a, b, m, n_1, n_2, n_3$, we can get different shapes.
#### Demonstration
Firstly, import the libraries, delete the existing objects, and then define the parameters and empty lists to store vertices, faces and edges.
```python
import bpy
import math
bpy.ops.object.select_all(action = 'SELECT')
bpy.ops.object.delete()
# mesh arrays
verts = []
faces = []
edges = []
 
#3D supershape parameters
m = 17
a = -0.06
b = 6
n1 = 0.5
n2 = -.48
n3 = 1


scale = 3
 
Unum = 50
Vnum = 50
 
Uinc = math.pi / (Unum/2)
Vinc = (math.pi/2)/(Vnum/2)
```
Then create the vertices,
```python  
# create vertices
theta = -math.pi
for i in range (0, Unum + 1):
    phi = -math.pi/2
    r1 = 1/(((abs(math.cos(m*theta/4)/a))**n2+(abs(math.sin(m*theta/4)/b))**n3)**n1)
    for j in range(0, Vnum + 1):
        r2 = 1/(((abs(math.cos(m*phi/4)/a))**n2+(abs(math.sin(m*phi/4)/b))**n3)**n1)
        x = scale * (r1 * math.cos(theta) * r2 * math.cos(phi))
        y = scale * (r1 * math.sin(theta) * r2 * math.cos(phi))
        z = scale * (r2 * math.sin(phi))
 
        vert = (x,y,z)
        verts.append(vert)
        #increment phi
        phi += Vinc
    #increment theta
    theta += Uinc
```
Create the faces,
```python
count = 0
for i in range (0, (Vnum + 1) *(Unum)):
    if count < Vnum:
        A = i
        B = i+1
        C = (i+(Vnum+1))+1
        D = (i+(Vnum+1))
 
        face = (A,B,C,D)
        faces.append(face)
 
        count = count + 1
    else:
        count = 0
```
Create mesh.
```python
#create mesh and object
mymesh = bpy.data.meshes.new("supershape")
myobject = bpy.data.objects.new("supershape",mymesh)
 
#set mesh location
myobject.location = (0, 0, 0)
bpy.context.scene.collection.objects.link(myobject)
 
#create mesh from python data
mymesh.from_pydata(verts,edges,faces)
mymesh.update(calc_edges=True)
```
Then we will get a shape like that
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/8.jpg'>

We can also make some other operations like smoothing.
```python
#set the object to edit mode
bpy.context.view_layer.objects.active = myobject
bpy.ops.object.mode_set(mode='EDIT')
 
# remove duplicate vertices
bpy.ops.mesh.remove_doubles() 
 
# recalculate normals
bpy.ops.mesh.normals_make_consistent(inside=False)
bpy.ops.object.mode_set(mode='OBJECT')
 
# subdivide modifier
myobject.modifiers.new("subd", type='SUBSURF')
myobject.modifiers['subd'].levels = 3
 
# show mesh as smooth
mypolys = mymesh.polygons
for p in mypolys:
    p.use_smooth = True
```
Final shape will be displayed like
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/9.jpg'>

You can also change the parameters to get a different shape as you want,
```python
m = 17
a = -0.06
b = 6
n1 = 0.6
n2 = -.6
n3 = 2
 
scale = 3
 
Unum = 80
Vnum = 80
```
<img src = 'https://raw.githubusercontent.com/HuJacobJiabao/HuJacobJiabao.github.io/main/blog/source/img/10.jpg'>